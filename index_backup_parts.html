<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAHAN KHATIWODA OFFICIAL - Enhanced 100-Days-Challenge</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Your existing CSS styles here */
        /* ... [Keep all your CSS styles] ... */
    </style>
</head>
<body>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="loading-spinner"></div>
    <div style="color: white; margin-top: 20px;">Initializing Enhanced Tracking System...</div>
    <div id="loadingProgress" style="color: #aaa; font-size: 14px; margin-top: 10px;"></div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Top Navigation -->
<div class="top-nav">
    <div class="logo-container">
        <div class="logo">GAHAN KHATIWODA</div>
        <div style="color: var(--gray); font-size: 12px;">Enhanced Visitor Tracking</div>
    </div>
    
    <div class="nav-controls">
        <button class="nav-btn" onclick="UI.showPrivacyModal()">
            <i class="fas fa-shield-alt"></i>
            <span>Privacy</span>
        </button>
        <button class="nav-btn" onclick="UI.showAnalyticsModal()">
            <i class="fas fa-chart-bar"></i>
            <span>Analytics</span>
        </button>
        <button class="nav-btn primary" onclick="UI.toggleDarkMode()">
            <i class="fas fa-moon"></i>
            <span>Theme</span>
        </button>
    </div>
</div>

<!-- Visitor Dashboard -->
<div class="visitor-dashboard">
    <div class="dashboard-content">
        <div class="dashboard-item">
            <div class="dashboard-icon" style="color: #00ff00;">
                <i class="fas fa-users"></i>
            </div>
            <div class="dashboard-text">
                <div class="dashboard-value" id="totalVisitors">0000</div>
                <div class="dashboard-label">Total Visitors</div>
            </div>
        </div>
        
        <div class="dashboard-item">
            <div class="dashboard-icon" style="color: #4285F4;">
                <i class="fas fa-user-check"></i>
            </div>
            <div class="dashboard-text">
                <div class="dashboard-value" id="uniqueVisitors">0000</div>
                <div class="dashboard-label">Unique Visitors</div>
            </div>
        </div>
        
        <div class="dashboard-item">
            <div class="dashboard-icon" style="color: #EA4335;">
                <i class="fas fa-circle"></i>
            </div>
            <div class="dashboard-text">
                <div class="dashboard-value" id="liveVisitors">00</div>
                <div class="dashboard-label">Live Now</div>
            </div>
        </div>
    </div>
</div>

<!-- Main Container -->
<div class="main-container">
    <!-- Login Screen -->
    <div id="loginScreen">
        <div class="section-header">
            <h1 class="section-title">100-DAYS-CHALLENGE</h1>
            <h2 class="section-subtitle">Computer Science • SEE 2082</h2>
            <p style="color: var(--gray); margin-top: 20px; font-size: 18px;">
                Complete Subjective & Objective Practice Sets with Enhanced Analytics
            </p>
        </div>
        
        <div class="login-form">
            <div class="form-tabs">
                <button class="tab-btn active" onclick="UI.switchTab('traditional')">
                    <i class="fas fa-user-lock"></i> Traditional Login
                </button>
                <button class="tab-btn" onclick="UI.switchTab('google')">
                    <i class="fab fa-google"></i> Google Login
                </button>
            </div>
            
            <!-- Traditional Login Tab -->
            <div id="traditionalTab" class="tab-content active">
                <div class="form-group">
                    <label for="username">
                        <span>Username / Email</span>
                        <span style="font-size: 12px; color: var(--gray);">
                            <i class="fas fa-info-circle"></i> Contact admin for credentials
                        </span>
                    </label>
                    <div class="input-wrapper">
                        <i class="fas fa-user input-icon"></i>
                        <input type="text" id="username" class="form-input with-icon" 
                               placeholder="Enter your username or email" 
                               autocomplete="username">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <div class="input-wrapper">
                        <i class="fas fa-key input-icon"></i>
                        <input type="password" id="password" class="form-input with-icon" 
                               placeholder="Enter your password" 
                               autocomplete="current-password">
                        <button type="button" class="password-toggle" onclick="UI.togglePassword()">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="rememberMe" style="width: auto;">
                    <label for="rememberMe" style="margin: 0; font-weight: normal;">Remember me for 24 hours</label>
                </div>
                
                <button class="login-btn" onclick="Auth.loginUser()" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Login to Access Content</span>
                </button>
                
                <div id="errorMessage" style="color: var(--accent); margin-top: 15px; text-align: center; display: none;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span id="errorText">Invalid username or password. Please try again.</span>
                </div>
            </div>
            
            <!-- Google Login Tab -->
            <div id="googleTab" class="tab-content">
                <div class="google-signin-container">
                    <p style="margin-bottom: 20px; color: var(--gray);">
                        Sign in with your Google account for faster access
                    </p>
                    
                    <!-- Google Sign-In Button Container -->
                    <div id="googleSignInContainer" style="margin-bottom: 20px;">
                        <!-- This will be replaced by Google button -->
                        <div id="g_id_onload"
                             data-client_id="789365890180-30fpjid0955op8rldf1js02br0t7jql3.apps.googleusercontent.com"
                             data-context="signin"
                             data-ux_mode="popup"
                             data-callback="handleCredentialResponse"
                             data-auto_prompt="false"
                             data-itp_support="true">
                        </div>
                        
                        <div class="g_id_signin"
                             data-type="standard"
                             data-shape="rectangular"
                             data-theme="outline"
                             data-text="signin_with"
                             data-size="large"
                             data-logo_alignment="left"
                             data-width="100%">
                        </div>
                    </div>
                    
                    <!-- Manual Google Button (Fallback) -->
                    <button id="manualGoogleBtn" onclick="Auth.triggerManualGoogleSignIn()" 
                            style="display: none; background: #4285F4; color: white; border: none; padding: 12px 24px; border-radius: 4px; cursor: pointer; width: 100%; margin-top: 10px; font-size: 16px;">
                        <i class="fab fa-google"></i> Sign in with Google
                    </button>
                    
                    <!-- Google User Info (hidden by default) -->
                    <div id="googleUserInfo" style="margin-top: 30px; display: none;">
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                            <img id="googleAvatar" style="width: 60px; height: 60px; border-radius: 50%; margin: 0 auto 15px; display: block;" src="" alt="Profile">
                            <h3 id="googleName" style="color: var(--primary); margin-bottom: 5px;"></h3>
                            <p id="googleEmail" style="color: var(--gray); font-family: 'Courier New'; margin-bottom: 20px;"></p>
                            
                            <button onclick="Auth.loginWithGoogle()" style="background: var(--success); color: white; border: none; padding: 12px 30px; border-radius: 8px; cursor: pointer; margin: 5px; font-size: 16px; width: 100%;">
                                <i class="fas fa-check-circle"></i> Continue with this Google Account
                            </button>
                            
                            <button onclick="Auth.googleLogout()" style="background: transparent; color: var(--gray); border: 1px solid #ddd; padding: 8px 20px; border-radius: 5px; cursor: pointer; margin: 5px; font-size: 14px; width: 100%;">
                                <i class="fas fa-sync"></i> Use different account
                            </button>
                        </div>
                    </div>
                    
                    <!-- Loading indicator -->
                    <div id="googleLoading" style="display: none; text-align: center; padding: 20px;">
                        <div class="loading-spinner" style="width: 30px; height: 30px; margin: 0 auto 10px;"></div>
                        <p style="color: var(--gray);">Processing Google Sign-In...</p>
                    </div>
                </div>
                
                <!-- Instructions -->
                <div style="margin-top: 25px; padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #4285F4;">
                    <h4 style="color: #4285F4; margin-bottom: 10px; font-size: 14px;">
                        <i class="fas fa-question-circle"></i> Google Sign-In Help
                    </h4>
                    <ul style="color: var(--gray); font-size: 12px; padding-left: 20px; margin: 0;">
                        <li>Make sure you're using a modern browser</li>
                        <li>Allow pop-ups for this site if prompted</li>
                        <li>If the button doesn't appear, click the manual button</li>
                        <li>Contact admin if your Google account is not authorized</li>
                    </ul>
                </div>
            </div>
            
            <div class="divider">
                <span>Security Information</span>
            </div>
            
            <div style="text-align: center; color: var(--gray); font-size: 13px;">
                <p><i class="fas fa-lock"></i> All connections are encrypted with SSL/TLS</p>
                <p><i class="fas fa-database"></i> Visitor tracking complies with privacy regulations</p>
                <p><i class="fas fa-clock"></i> Sessions expire after 30 minutes of inactivity</p>
            </div>
        </div>
        
        <!-- Features Section -->
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-book-open"></i>
                </div>
                <h3 class="feature-title">Odd Days Sets</h3>
                <p style="color: var(--gray);">Comprehensive subjective question bank with detailed solutions</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-book"></i>
                </div>
                <h3 class="feature-title">Even Days Sets</h3>
                <p style="color: var(--gray);">Advanced practice questions with step-by-step explanations</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-check-double"></i>
                </div>
                <h3 class="feature-title">Objective Sets</h3>
                <p style="color: var(--gray);">MCQ and quick review with instant feedback system</p>
            </div>
        </div>
    </div>
    
    <!-- Success Screen -->
    <div class="success-screen" id="successScreen">
        <div class="section-header">
            <div class="success-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h1 class="section-title">Access Granted!</h1>
            <h2 class="section-subtitle">Welcome to Enhanced Learning Platform</h2>
        </div>
        
        <div class="user-info-card">
            <h3 style="color: var(--primary); margin-bottom: 20px;">
                <i class="fas fa-user-circle"></i> User Information
            </h3>
            <div class="user-info-row">
                <span style="font-weight: 600;">Username:</span>
                <span id="displayUsername">Loading...</span>
            </div>
            <div class="user-info-row">
                <span style="font-weight: 600;">Email:</span>
                <span id="displayEmail">Loading...</span>
            </div>
            <div class="user-info-row">
                <span style="font-weight: 600;">Login Method:</span>
                <span id="displayMethod">Loading...</span>
            </div>
            <div class="user-info-row">
                <span style="font-weight: 600;">Session Started:</span>
                <span id="displaySessionTime">Loading...</span>
            </div>
            <div class="user-info-row">
                <span style="font-weight: 600;">Your Visitor ID:</span>
                <span id="displayVisitorId" style="font-family: 'Courier New'; color: var(--primary);">Loading...</span>
            </div>
        </div>
        
        <p style="color: var(--gray); margin: 30px 0; font-size: 16px;">
            <i class="fas fa-sync-alt"></i> Your progress is automatically saved. Choose content to begin:
        </p>
        
        <div class="content-grid">
            <div class="content-card odd" onclick="UI.goToContent('odd')">
                <div style="font-size: 40px; color: #FF9800; margin-bottom: 15px;">
                    <i class="fas fa-file-alt"></i>
                </div>
                <h3 style="color: var(--dark); margin-bottom: 10px;">ODD-DAYS SETS</h3>
                <p style="color: var(--gray); font-size: 14px;">Subjective practice with solutions</p>
                <div style="margin-top: 15px; color: #FF9800; font-size: 12px;">
                    <i class="fas fa-arrow-right"></i> Click to access
                </div>
            </div>
            
            <div class="content-card even" onclick="UI.goToContent('even')">
                <div style="font-size: 40px; color: #2196F3; margin-bottom: 15px;">
                    <i class="fas fa-book"></i>
                </div>
                <h3 style="color: var(--dark); margin-bottom: 10px;">EVEN-DAYS SETS</h3>
                <p style="color: var(--gray); font-size: 14px;">Advanced questions & explanations</p>
                <div style="margin-top: 15px; color: #2196F3; font-size: 12px;">
                    <i class="fas fa-arrow-right"></i> Click to access
                </div>
            </div>
            
            <div class="content-card obj" onclick="UI.goToContent('obj')">
                <div style="font-size: 40px; color: #9C27B0; margin-bottom: 15px;">
                    <i class="fas fa-check-double"></i>
                </div>
                <h3 style="color: var(--dark); margin-bottom: 10px;">OBJECTIVE SETS</h3>
                <p style="color: var(--gray); font-size: 14px;">MCQ practice with instant feedback</p>
                <div style="margin-top: 15px; color: #9C27B0; font-size: 12px;">
                    <i class="fas fa-arrow-right"></i> Click to access
                </div>
            </div>
        </div>
        
        <div style="display: flex; gap: 15px; justify-content: center; margin-top: 40px;">
            <button onclick="Auth.logout()" style="background: var(--accent); color: white; border: none; padding: 12px 30px; border-radius: 8px; cursor: pointer; font-size: 16px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
            <button onclick="UI.showSessionInfo()" style="background: var(--primary); color: white; border: none; padding: 12px 30px; border-radius: 8px; cursor: pointer; font-size: 16px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-info-circle"></i> Session Info
            </button>
        </div>
    </div>
</div>

<!-- Analytics Modal -->
<div id="analyticsModal" class="analytics-modal">
    <!-- ... Your analytics modal content ... -->
</div>

<!-- Privacy Modal -->
<div id="privacyModal" class="privacy-modal">
    <!-- ... Your privacy modal content ... -->
</div>

<!-- Footer -->
<footer style="color: white; text-align: center; padding: 30px; opacity: 0.8;">
    <p style="margin-bottom: 10px;">© 2023 Gahan Khatiwoda Official • Enhanced Visitor Tracking System v2.0</p>
    <p style="font-size: 14px;">
        <i class="fas fa-heart" style="color: #ff4444;"></i> 
        Built with advanced analytics & privacy-first approach
    </p>
</footer>

<!-- Google Identity Services -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<!-- Global callback wrapper -->
<script>
    // Global wrapper for Google callback
    window.handleCredentialResponse = function(response) {
        console.log('Google callback received');
        
        // Check if Auth module is loaded
        if (typeof Auth !== 'undefined' && typeof Auth.handleCredentialResponse === 'function') {
            Auth.handleCredentialResponse(response);
        } else {
            console.error('Auth module not loaded yet');
            // Store credential for later use
            if (response && response.credential) {
                localStorage.setItem('pending_google_credential', response.credential);
                console.log('Credential stored for later processing');
                
                // Show message to user
                if (typeof UI !== 'undefined' && typeof UI.showToast === 'function') {
                    UI.showToast('Google sign-in received. Processing...', 'info');
                }
            }
        }
    };
</script>

<!-- Module Imports -->
<script src="modules/utils.js"></script>
<script src="modules/tracking.js"></script>
<script src="modules/auth.js"></script>
<script src="modules/ui.js"></script>
<script src="modules/analytics.js"></script>
<script src="app.js"></script>

</body>
</html>
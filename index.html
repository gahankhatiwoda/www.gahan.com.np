<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAHAN KHATIWODA OFFICIAL - 100-Days-Challenge</title>
    <style>
        /* Your existing CSS styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #333;
        }
        
        .main-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            text-align: center;
            margin-top: 20px;
        }
        
        .logo {
            font-size: 60px;
            color: #EA4335;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #1a2980;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        h2 {
            color: #26d0ce;
            margin-bottom: 30px;
            font-weight: 300;
        }
        
        .login-form {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: left;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: bold;
        }
        
        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .login-btn {
            background: linear-gradient(90deg, #4285F4, #34A853);
            color: white;
            border: none;
            padding: 20px 50px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            transition: all 0.3s;
            box-shadow: 0 10px 25px rgba(66, 133, 244, 0.3);
            width: 100%;
            justify-content: center;
        }
        
        .error-message {
            color: #EA4335;
            margin-top: 15px;
            text-align: center;
            display: none;
            padding: 10px;
            background: rgba(234, 67, 53, 0.1);
            border-radius: 8px;
            border-left: 4px solid #EA4335;
        }
        
        .google-user-info {
            background: #e8f0fe;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }
        
        .google-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: block;
            border: 3px solid #4285F4;
        }
        
        .divider {
            display: flex;
            align-items: center;
            margin: 20px 0;
            color: #666;
            font-size: 14px;
        }
        
        .divider::before,
        .divider::after {
            content: "";
            flex: 1;
            border-bottom: 1px solid #ddd;
        }
        
        .divider span {
            padding: 0 15px;
        }
        
        .success-screen {
            display: none;
        }
        
        .success-icon {
            font-size: 80px;
            color: #34A853;
            margin-bottom: 20px;
        }
    </style>
    
    <!-- Google OAuth Library -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>

<div class="main-container">
    <!-- Login Screen -->
    <div id="loginScreen">
        <div class="logo">G</div>
        <h1>GAHAN KHATIWODA</h1>
        <h2>100-DAYS-CHALLENGE-COMPUTER SCIENCE</h2>
        
        <p class="description">
            Complete Subjective and Objective Practice Sets for Computer Science-SEE 2082
        </p>
        
        <div class="login-form">
            <div class="form-group">
                <label for="username">Username / Email</label>
                <input type="text" id="username" placeholder="Enter your username or email">
            </div>
            
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Enter your password">
            </div>
            
            <button class="login-btn" onclick="loginUser()">
                <div class="btn-icon">üîê</div>
                Login to Access Content
            </button>
            
            <div id="errorMessage" class="error-message">
                ‚ùå Invalid username or password. Please try again.
            </div>
            
            <!-- Google OAuth Section -->
            <div class="divider">
                <span>Or continue with Google</span>
            </div>
            
            <div class="google-section">
                <!-- Google Sign-In Button -->
                <div id="g_id_onload"
                    data-client_id="YOUR_CLIENT_ID.apps.googleusercontent.com"
                    data-context="signin"
                    data-ux_mode="popup"
                    data-callback="handleCredentialResponse"
                    data-auto_prompt="false">
                </div>

                <div class="g_id_signin"
                    data-type="standard"
                    data-shape="rectangular"
                    data-theme="outline"
                    data-text="signin_with"
                    data-size="large"
                    data-logo_alignment="left"
                    data-width="100%">
                </div>
            </div>
            
            <!-- Google User Info -->
            <div id="googleUserInfo" class="google-user-info">
                <img id="googleAvatar" class="google-avatar" src="" alt="Profile">
                <h3 id="googleName" style="color: #1a2980;"></h3>
                <p id="googleEmail" style="color: #666; font-family: 'Courier New';"></p>
                <button onclick="loginWithGoogle()" style="
                    background: #34A853;
                    color: white;
                    border: none;
                    padding: 12px 24px;
                    border-radius: 8px;
                    cursor: pointer;
                    margin-top: 15px;
                    font-size: 16px;
                ">
                    ‚úÖ Continue with this Google Account
                </button>
                <button onclick="googleLogout()" style="
                    background: #EA4335;
                    color: white;
                    border: none;
                    padding: 8px 16px;
                    border-radius: 5px;
                    cursor: pointer;
                    margin-top: 10px;
                    font-size: 14px;
                ">
                    üîÑ Use different account
                </button>
            </div>
            
            <div style="text-align: center; margin-top: 20px; color: #666; font-size: 14px;">
                <p><strong>Note:</strong> Google login only works if your Gmail is already registered in the system.</p>
                <p>Contact admin to add your Gmail to the system.</p>
                <p>Default credentials: Username: <strong>gahan</strong> | Password: <strong>gahan</strong></p>
            </div>
        </div>
    </div>
    
    <!-- Success Screen -->
    <div class="success-screen" id="successScreen">
        <div class="success-icon">‚úÖ</div>
        <h1>Login Successful!</h1>
        <p>Welcome to Gahan's 100-Days Challenge</p>
        
        <div class="user-info" id="userInfoDisplay">
            Loading user information...
        </div>
        
        <p>Your progress is automatically saved. Choose content to begin:</p>
        
        <div class="content-buttons">
            <button class="content-btn odd-btn" onclick="goToContent('odd')">
                üìö ODD DAYS SETS
            </button>
            <button class="content-btn even-btn" onclick="goToContent('even')">
                üìñ EVEN DAYS SETS
            </button>
            <button class="content-btn obj-btn" onclick="goToContent('obj')">
                ‚úÖ OBJECTIVE SETS
            </button>
        </div>
        
        <button onclick="logout()" style="
            background: #EA4335;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
        ">
            Logout
        </button>
    </div>
</div>

<script>
// ========== USER CREDENTIALS SYSTEM ==========
// ONLY these users can login via Google OAuth or traditional method
// If a Google email is not in this array, they CANNOT login

const VALID_USERS = [
    { 
        username: "student", 
        password: "banshagopal", 
        email: "student@gmail.com"  // Gmail that can login via Google OAuth
    },
    { 
        username: "gahan", 
        password: "gahan", 
        email: "gahan@gmail.com"    // Gmail that can login via Google OAuth
    },
    { 
        username: "admin", 
        password: "admin", 
        email: "admin@gmail.com"    // Gmail that can login via Google OAuth
    }
    // Add more users here if you want them to have Google OAuth access
    // Format: { username: "username", password: "password", email: "gmail@gmail.com" }
];

const ADMIN_PASSWORD = "Gahan123";

// ========== GOOGLE OAUTH ==========

let googleUserData = null;

// Handle Google Sign-In response
function handleCredentialResponse(response) {
    console.log("‚úÖ Google Sign-In Successful!");
    
    try {
        // Decode the JWT token
        const token = response.credential;
        const base64Url = token.split('.')[1];
        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        
        const payload = JSON.parse(jsonPayload);
        
        // Extract user information
        googleUserData = {
            email: payload.email,
            name: payload.name,
            picture: payload.picture,
            given_name: payload.given_name,
            family_name: payload.family_name,
            email_verified: payload.email_verified,
            token: token,
            timestamp: new Date().toISOString()
        };
        
        console.log("üìß Google User:", googleUserData);
        
        // Show Google user info
        document.getElementById('googleUserInfo').style.display = 'block';
        document.getElementById('googleAvatar').src = googleUserData.picture;
        document.getElementById('googleName').textContent = googleUserData.name;
        document.getElementById('googleEmail').textContent = googleUserData.email;
        
        // Hide Google sign-in button
        document.querySelector('.g_id_signin').style.display = 'none';
        
    } catch (error) {
        console.error('Error processing Google response:', error);
        showError('Failed to process Google authentication. Please try again.');
    }
}

function loginWithGoogle() {
    if (!googleUserData) {
        showError('Please sign in with Google first');
        return;
    }
    
    const googleEmail = googleUserData.email;
    
    // Check if this Gmail exists in our VALID_USERS array
    const user = VALID_USERS.find(u => u.email === googleEmail);
    
    if (user) {
        // Gmail is in VALID_USERS, allow login
        const button = document.querySelector('.login-btn');
        const originalHTML = button.innerHTML;
        button.innerHTML = '<div class="btn-icon">‚úì</div> Logging in with Google...';
        button.disabled = true;
        
        setTimeout(() => {
            const sessionId = 'google_' + Date.now() + '_' + Math.random().toString(36).substr(2, 8);
            const loginTime = new Date().toISOString();
            
            localStorage.setItem('current_username', user.username);
            
            // Save user session
            localStorage.setItem('gahan_user', JSON.stringify({
                username: user.username,
                email: user.email,
                sessionId: sessionId,
                loginTime: loginTime,
                userAgent: navigator.userAgent,
                loginMethod: 'google_oauth',
                googleUserData: googleUserData
            }));
            
            // Save to analytics
            logGoogleLogin(googleUserData);
            
            updateVisitorCounter();
            logUserLogin(user.username, user.email, 'google_oauth');
            showSuccessScreen(user.username, user.email, loginTime);
            
            // Reset button
            button.innerHTML = originalHTML;
            button.disabled = false;
            
        }, 1000);
    } else {
        // Gmail is NOT in VALID_USERS, show error
        showError(`Google account "${googleEmail}" is not registered in the system. 
                  Please contact administrator to add your email or use traditional login.`);
        
        // Optionally, you can automatically logout from Google
        setTimeout(() => {
            googleLogout();
        }, 3000);
    }
}

function googleLogout() {
    googleUserData = null;
    document.getElementById('googleUserInfo').style.display = 'none';
    document.querySelector('.g_id_signin').style.display = 'block';
    
    // Revoke Google token
    if (typeof google !== 'undefined' && google.accounts) {
        google.accounts.id.revoke(localStorage.getItem('google_token'), done => {
            console.log('Google token revoked');
        });
    }
}

function logGoogleLogin(userData) {
    const log = {
        type: 'google_oauth_login',
        timestamp: new Date().toISOString(),
        email: userData.email,
        name: userData.name,
        email_verified: userData.email_verified,
        userAgent: navigator.userAgent
    };
    
    // Save to analytics
    let history = JSON.parse(localStorage.getItem('gahan_user_history') || '[]');
    history.push(log);
    localStorage.setItem('gahan_user_history', JSON.stringify(history));
    
    console.log('üìä Google Login Logged:', log);
}

// ========== TRADITIONAL LOGIN ==========

function loginUser() {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;
    const errorDiv = document.getElementById('errorMessage');
    
    errorDiv.style.display = 'none';
    
    if (!username || !password) {
        showError("Please enter both username and password");
        return;
    }
    
    // Check both username and email
    const user = VALID_USERS.find(u => 
        (u.username === username || u.email === username) && u.password === password
    );
    
    if (user) {
        const button = document.querySelector('.login-btn');
        const originalHTML = button.innerHTML;
        button.innerHTML = '<div class="btn-icon">‚úì</div> Logging in...';
        button.disabled = true;
        
        setTimeout(() => {
            const sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 8);
            const loginTime = new Date().toISOString();
            
            localStorage.setItem('current_username', user.username);
            
            localStorage.setItem('gahan_user', JSON.stringify({
                username: user.username,
                email: user.email,
                sessionId: sessionId,
                loginTime: loginTime,
                userAgent: navigator.userAgent,
                loginMethod: 'traditional'
            }));
            
            updateVisitorCounter();
            logUserLogin(user.username, user.email, 'traditional');
            showSuccessScreen(user.username, user.email, loginTime);
            
            button.innerHTML = originalHTML;
            button.disabled = false;
            
        }, 1000);
    } else {
        showError("Invalid username or password. Please try again.");
        document.getElementById('password').value = '';
        document.getElementById('password').focus();
        console.log('‚ùå Failed login attempt with:', username);
    }
}

function showError(message) {
    const errorDiv = document.getElementById('errorMessage');
    errorDiv.textContent = message;
    errorDiv.style.display = 'block';
}

// ========== SUCCESS SCREEN ==========

function showSuccessScreen(username, email, loginTime) {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('successScreen').style.display = 'block';
    
    const formattedTime = new Date(loginTime).toLocaleString('en-US', {
        hour: '2-digit',
        minute: '2-digit',
        month: 'short',
        day: 'numeric'
    });
    
    const userData = JSON.parse(localStorage.getItem('gahan_user') || '{}');
    const loginMethod = userData.loginMethod === 'google_oauth' 
        ? 'Google OAuth' 
        : 'Traditional Login';
    
    document.getElementById('userInfoDisplay').innerHTML = `
        <strong>Welcome, ${username}!</strong><br>
        <span style="color: #1a2980;">Email: ${email}</span><br>
        <small>Logged in via: ${loginMethod}</small><br>
        <small>Time: ${formattedTime}</small>
    `;
}

function goToContent(contentType) {
    const userData = JSON.parse(localStorage.getItem('gahan_user') || '{}');
    
    logContentAccess(userData.username, contentType);
    
    localStorage.setItem('gahan_last_access', contentType);
    localStorage.setItem('gahan_last_access_time', new Date().toISOString());
    
    alert(`Redirecting to ${contentType.toUpperCase()} content...`);
    // For now, just show alert. Replace with actual navigation:
    // if (contentType === 'odd') window.location.href = 'odd.html';
    // else if (contentType === 'even') window.location.href = 'even.html';
    // else if (contentType === 'obj') window.location.href = 'obj.html';
}

function logout() {
    const userData = JSON.parse(localStorage.getItem('gahan_user') || '{}');
    
    if (userData.loginMethod === 'google_oauth') {
        googleLogout();
    }
    
    logUserLogout(userData.username);
    
    localStorage.removeItem('gahan_user');
    localStorage.removeItem('current_username');
    location.reload();
}

// ========== ANALYTICS FUNCTIONS ==========

function updateVisitorCounter() {
    let count = localStorage.getItem('gahan_total_visitors') || 1000;
    count = parseInt(count) + 1;
    localStorage.setItem('gahan_total_visitors', count);
}

function logUserLogin(username, email, method) {
    const logData = {
        type: 'login',
        username: username,
        email: email,
        method: method,
        timestamp: new Date().toISOString(),
        userAgent: navigator.userAgent
    };
    
    let history = JSON.parse(localStorage.getItem('gahan_user_history') || '[]');
    history.push(logData);
    localStorage.setItem('gahan_user_history', JSON.stringify(history));
}

function logUserLogout(username) {
    const logData = {
        type: 'logout',
        username: username,
        timestamp: new Date().toISOString()
    };
    
    let history = JSON.parse(localStorage.getItem('gahan_user_history') || '[]');
    history.push(logData);
    localStorage.setItem('gahan_user_history', JSON.stringify(history));
}

function logContentAccess(username, contentType) {
    const logData = {
        type: 'content_access',
        username: username,
        contentType: contentType,
        timestamp: new Date().toISOString(),
        page: window.location.href
    };
    
    let history = JSON.parse(localStorage.getItem('gahan_user_history') || '[]');
    history.push(logData);
    localStorage.setItem('gahan_user_history', JSON.stringify(history));
}

// ========== INITIALIZATION ==========

window.onload = function() {
    updateVisitorCounter();
    
    // Check for existing session
    checkExistingSession();
    
    // Set up enter key for password field
    document.getElementById('password').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            loginUser();
        }
    });
    
    document.getElementById('username').focus();
};

function checkExistingSession() {
    const userData = localStorage.getItem('gahan_user');
    if (userData) {
        const user = JSON.parse(userData);
        const loginTime = new Date(user.loginTime);
        const now = new Date();
        const hoursDiff = (now - loginTime) / (1000 * 60 * 60);
        
        // Session valid for 24 hours
        if (hoursDiff < 24) {
            showSuccessScreen(user.username, user.email, user.loginTime);
        } else {
            localStorage.removeItem('gahan_user');
        }
    }
}

// ========== UTILITY FUNCTIONS ==========

// Add new user function (admin only)
function addUser(newUsername, newPassword, newEmail) {
    VALID_USERS.push({
        username: newUsername,
        password: newPassword,
        email: newEmail
    });
    console.log('‚úÖ User added:', newUsername);
    alert(`User ${newUsername} (${newEmail}) added successfully!`);
}

// Get all valid emails (for admin reference)
function getAllValidEmails() {
    return VALID_USERS.map(user => user.email);
}

// Check if email is registered
function isEmailRegistered(email) {
    return VALID_USERS.some(user => user.email === email);
}
</script>

<style>
/* Add these styles for the content buttons */
.content-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin: 30px 0;
    flex-wrap: wrap;
}

.content-btn {
    padding: 18px 30px;
    border: none;
    border-radius: 10px;
    font-size: 17px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 12px;
    min-width: 200px;
    justify-content: center;
}

.odd-btn { background: #FF9800; color: white; }
.even-btn { background: #2196F3; color: white; }
.obj-btn { background: #9C27B0; color: white; }

.user-info {
    background: #e8f0fe;
    padding: 15px;
    border-radius: 10px;
    margin: 25px 0;
    font-family: 'Courier New', monospace;
}

@media (max-width: 768px) {
    .content-buttons {
        flex-direction: column;
        align-items: center;
    }
    
    .content-btn {
        width: 100%;
        max-width: 300px;
    }
}
</style>
</body>
</html>